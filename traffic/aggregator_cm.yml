apiVersion: v1
kind: ConfigMap
metadata:
  name: aggregator-conf
  namespace: traffic
data:
  fluent-bit.conf: |
    [SERVICE]
      Flush      1
      Log_Level  info

    [INPUT]
      Name    forward
      Tag     ds.in
      Listen  0.0.0.0
      Port    24224

    [OUTPUT]
      Name      file
      Match     ds.in
      Path      /logs
      File      all.log
      Format    template
      Template  {log}
  goaccess.conf: |
    datetime-format %d/%b/%Y:%H:%M:%S %z
    log-format %h %^ [%x] %v %^ %^ "%r" %s %b "%R" "%u" %K %k "%M" %T
    
    real-time-html true
    ws-url wss://traffic.pmh.codes/ws
    output /render/index.html
    port 443

    num-tests 0
    ignore-panel ""
    anonymize-ip true
    real-os true

    geoip-database /logs/GeoLite2-ASN.mmdb
    geoip-database /logs/GeoLite2-City.mmdb

    html-prefs {"autoHideTables":true,"layout":"wide","perPage":24,"theme":"darkGray","hiddenPanels":[],"visitors":{"plot":{"chartType":"area-spline","metric":"bandwidth"},"columns":{"avgts":{"hide":true},"cumts":{"hide":true},"maxts":{"hide":true}}},"requests":{"plot":{"chartType":"bar","metric":"hits-visitors"},"columns":{"maxts":{"hide":true},"cumts":{"hide":true},"avgts":{"hide":true}}},"showTables":false,"not_found":{"columns":{"cumts":{"hide":true},"avgts":{"hide":true},"maxts":{"hide":true}},"chart":true,"plot":{"chartType":"bar"}},"hosts":{"columns":{"avgts":{"hide":true},"cumts":{"hide":true},"maxts":{"hide":true}}},"os":{"columns":{"cumts":{"hide":true},"maxts":{"hide":true},"avgts":{"hide":true}}},"browsers":{"columns":{"cumts":{"hide":true},"avgts":{"hide":true},"maxts":{"hide":true}}},"visit_time":{"columns":{"cumts":{"hide":true},"avgts":{"hide":true},"maxts":{"hide":true}},"plot":{"metric":"hits-visitors"}},"referrers":{"columns":{"avgts":{"hide":true},"cumts":{"hide":true},"maxts":{"hide":true}}},"referring_sites":{"columns":{"avgts":{"hide":true},"cumts":{"hide":true},"maxts":{"hide":true}}},"status_codes":{"columns":{"avgts":{"hide":true},"cumts":{"hide":true},"maxts":{"hide":true}}}}
