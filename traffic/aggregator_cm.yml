apiVersion: v1
kind: ConfigMap
metadata:
  name: aggregator-conf
  namespace: traffic
data:
  fluent-bit.conf: |
    [SERVICE]
      Flush      1
      Log_Level  info

    [INPUT]
      Name    forward
      Tag     ds.in
      Listen  0.0.0.0
      Port    24224

    [OUTPUT]
      Name      file
      Match     ds.in
      Path      /logs
      File      all.log
      Format    template
      Template  {log}
  goaccess.conf: |
    time-format %T
    date-format %d/%b/%Y
    log-format %h %^ %^ [%d:%t %^] "%m %U %H" %s %b "%R" "%u" %^ %L %^ %^ %^ %^ %^ %^ %^
    
    real-time-html true
    ws-url wss://traffic.pmh.codes/ws
    output /render/index.html
    port 443

    ignore-panel REQUESTS_STATIC
    ignore-panel KEYPHRASES
    anonymize-ip true
    real-os true

    html-prefs {"autoHideTables":true,"layout":"vertical","perPage":24,"theme":"darkBlue","hiddenPanels":[],"visitors":{"plot":{"chartType":"area-spline","metric":"bandwidth"},"columns":{"avgts":{"hide":true},"cumts":{"hide":true},"maxts":{"hide":true}}},"requests":{"plot":{"chartType":"bar","metric":"hits-visitors"},"columns":{"maxts":{"hide":true},"cumts":{"hide":true},"avgts":{"hide":true}}},"showTables":true,"not_found":{"columns":{"cumts":{"hide":true},"avgts":{"hide":true},"maxts":{"hide":true}}},"hosts":{"columns":{"avgts":{"hide":true},"cumts":{"hide":true},"maxts":{"hide":true}}},"os":{"columns":{"cumts":{"hide":true},"maxts":{"hide":true},"avgts":{"hide":true}}},"browsers":{"columns":{"cumts":{"hide":true},"avgts":{"hide":true},"maxts":{"hide":true}}},"visit_time":{"columns":{"cumts":{"hide":true},"avgts":{"hide":true},"maxts":{"hide":true}},"plot":{"metric":"hits-visitors"}},"referrers":{"columns":{"avgts":{"hide":true},"cumts":{"hide":true},"maxts":{"hide":true}}},"referring_sites":{"columns":{"avgts":{"hide":true},"cumts":{"hide":true},"maxts":{"hide":true}}},"status_codes":{"columns":{"avgts":{"hide":true},"cumts":{"hide":true},"maxts":{"hide":true}}}}
