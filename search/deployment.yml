apiVersion: apps/v1
kind: Deployment
metadata:
  name: search 
spec:
  replicas: 1
  selector:
    matchLabels:
      app: search 
  template:
    metadata:
      labels:
        app: search 
    spec:
      containers:
      - name: search 
        image: ghcr.io/pmh-only/sosse:latest
        env:
        - name: SOSSE_DB_NAME
          value: search
        - name: SOSSE_DB_USER
          value: search
        - name: SOSSE_DB_HOST
          value: pgsql-service.database.svc.cluster.local
        - name: SOSSE_DB_PASS
          valueFrom:
            secretKeyRef:
              name: search-secret
              key: SOSSE_DB_PASS
        - name: SOSSE_SECRET_KEY
          valueFrom:
            secretKeyRef:
              name: search-secret
              key: SOSSE_SECRET_KEY
        - name: SOSSE_ANONYMOUS_SEARCH
          value: 'True'
        - name: SOSSE_SEARCH_SHORTCUT_CHAR
          value: '/'
        volumeMounts:
          - mountPath: /var/lib/sosse
            name: search-pvc
      volumes:
        - name: search-pvc
          persistentVolumeClaim:
            claimName: search-pvc
